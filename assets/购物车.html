<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="stylesheet" type="text/css" href="css/base.css"/>
<link rel="stylesheet" type="text/css" href="css/master.css"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>购物车 - 个人学习</title>
</head>

<body>
<div class="shopcar wrapper mt30">
	<div class="s-title">
    	<span class="pl15 ml1">全部商品</span>
        <span class="fr f14 gray">
        	已选商品（不含运费）<span class="red total-money">￥289</span>
            <a href="javascript:;">结算</a>
        </span>
    </div>
    <div class="shopcar-box mb30 pb30">
    	<div class="shopcar-head pl15 ml1 mt20">
        	<label class="fl"><input type="checkbox" class="mr5 all-choose"/>全选</label>
            <span class="fl sh-info ml30">商品信息</span>
            <span class="fl sh-price">单价（元）</span>
            <span class="fl sh-num">数量</span>
            <span class="fl sh-price-account">小计（元）</span>
            <span class="fl">操作</span>
        </div>
	    <div class="cl"></div>
        <!--购物车列表 start-->
        <div class="shopcar-list mt15">
        	<div class="sl-item mt10">
                <label><input type="checkbox" class="store-choose mr5 ml15 pl1"/>店铺的名称显示测试</label>
                <!--选中增加store-choose-->
                <div class="store-item mt10 trans">
                	<!--商品样式-->
                    <div class="product-info">
                        <input type="checkbox" class="product-choose"/>
                        <div class="pi-box">
                            <a href="#" class="sl-img fl"><img src="img/gray.png"/></a>
                            <a href="#" class="sl-title trans fl">产品名称产品名称产品名称产品名称产品名称产品名称产品名称</a>
                            <div class="sl-size fl">
                                <p class="hidden-text">规格：阿斯顿发几克拉水电费</p>
                                <p class="hidden-text">尺码：阿斯顿发几克拉水电费</p>
                            </div>
                            <div class="sl-price fl hidden-text">
                                200.00
                            </div>
                            <div class="amount-count mt5 fl">
                                <a href="javascript:;" class="fl sl-subtract">-</a>
                                <input type="text" value="10" class="fl sl-num"/>
                                <a href="javascript:;" class="fl sl-addition">+</a>
                            </div>
                            <div class="red fl sl-total-price">
                                1000.00
                            </div>
                            <div class="sl-oprate fl mt10">
                                <p><a href="#">删除</a></p>
                                <p><a href="#">移入我的收藏</a></p>
                            </div>
							<div class="delete hide" style="width:80px;text-align:center;height:80px;line-height:80px;color:#fff;font-size:18px;background:#369;position:absolute;right:-90px;">
								删除
							</div>
						</div>
                    </div>
                    <div class="product-info">
                        <input type="checkbox" class="product-choose"/>
                        <div class="pi-box">
                            <a href="#" class="sl-img fl"><img src="img/gray.png"/></a>
                            <a href="#" class="sl-title trans fl">产品名称产品名称产品名称产品名称产品名称产品名称产品名称</a>
                            <div class="sl-size fl">
                                <p class="hidden-text">规格：阿斯顿发几克拉水电费</p>
                                <p class="hidden-text">尺码：阿斯顿发几克拉水电费</p>
                            </div>
                            <div class="sl-price fl hidden-text">
                                200.00
                            </div>
                            <div class="amount-count mt5 fl">
                                <a href="javascript:;" class="fl sl-subtract">-</a>
                                <input type="text" value="10" class="fl sl-num"/>
                                <a href="javascript:;" class="fl sl-addition">+</a>
                            </div>
                            <div class="red fl sl-total-price">
                                1000.00
                            </div>
                            <div class="sl-oprate fl mt10">
                                <p><a href="#">删除</a></p>
                                <p><a href="#">移入我的收藏</a></p>
                            </div>
						</div>
                    </div>
                </div>
            </div>
        	<div class="sl-item mt10">
                <label><input type="checkbox" class="store-choose mr5 ml15 pl1"/>店铺的名称显示测试</label>
                <!--选中增加store-choose-->
                <div class="store-item mt10 trans">
                	<!--商品样式-->
                    <!--失效样式加pi-gray，将文字改为失效-->
                    <div class="product-info pi-gray">
                        <span class="product-choose">失效</span>
                        <div class="pi-box">
                            <a href="#" class="sl-img fl"><img src="img/gray.png"/></a>
                            <a href="#" class="sl-title trans fl">产品名称产品名称产品名称产品名称产品名称产品名称产品名称</a>
                            <div class="sl-size fl">
                                <p class="hidden-text">规格：阿斯顿发几克拉水电费</p>
                                <p class="hidden-text">尺码：阿斯顿发几克拉水电费</p>
                            </div>
                            <div class="sl-price fl hidden-text">
                                200.00
                            </div>
                            <div class="amount-count mt5 fl">
                                <a href="javascript:;" class="fl sl-subtract">-</a>
                                <input type="text" value="10" class="fl sl-num"/>
                                <a href="javascript:;" class="fl sl-addition">+</a>
                            </div>
                            <div class="red fl sl-total-price">
                                1000.00
                            </div>
                            <div class="sl-oprate fl mt10">
                                <p><a href="#">删除</a></p>
                                <p><a href="#">移入我的收藏</a></p>
                            </div>
						</div>
                    </div>
                    <div class="product-info">
                        <input type="checkbox" class="product-choose"/>
                        <div class="pi-box">
                            <a href="#" class="sl-img fl"><img src="img/gray.png"/></a>
                            <a href="#" class="sl-title trans fl">产品名称产品名称产品名称产品名称产品名称产品名称产品名称</a>
                            <div class="sl-size fl">
                                <p class="hidden-text">规格：阿斯顿发几克拉水电费</p>
                                <p class="hidden-text">尺码：阿斯顿发几克拉水电费</p>
                            </div>
                            <div class="sl-price fl hidden-text">
                                200.00
                            </div>
                            <div class="amount-count mt5 fl">
                                <a href="javascript:;" class="fl sl-subtract">-</a>
                                <input type="text" value="10" class="fl sl-num"/>
                                <a href="javascript:;" class="fl sl-addition">+</a>
                            </div>
                            <div class="red fl sl-total-price">
                                100.00
                            </div>
                            <div class="sl-oprate fl mt10">
                                <p><a href="#">删除</a></p>
                                <p><a href="#">移入我的收藏</a></p>
                            </div>
						</div>
                    </div>
                    <div class="product-info">
                        <input type="checkbox" class="product-choose"/>
                        <div class="pi-box">
                            <a href="#" class="sl-img fl"><img src="img/gray.png"/></a>
                            <a href="#" class="sl-title trans fl">产品名称产品名称产品名称产品名称产品名称产品名称产品名称</a>
                            <div class="sl-size fl">
                                <p class="hidden-text">规格：阿斯顿发几克拉水电费</p>
                                <p class="hidden-text">尺码：阿斯顿发几克拉水电费</p>
                            </div>
                            <div class="sl-price fl hidden-text">
                                100.00
                            </div>
                            <!--库存紧张状态加class“amount-tension”，再里面创建一个标签-->
                            <div class="amount-count fl amount-tension">
                                <a href="javascript:;" class="fl sl-subtract">-</a>
                                <input type="text" value="10" class="fl sl-num"/>
                                <a href="javascript:;" class="fl sl-addition">+</a>
                                <span class="db tc orange">库存紧张</span>
                            </div>
                            <div class="red fl sl-total-price">
                                1000.00
                            </div>
                            <div class="sl-oprate fl mt10">
                                <p><a href="#">删除</a></p>
                                <p><a href="#">移入我的收藏</a></p>
                            </div>
						</div>
                    </div>
                </div>
            </div>
		</div>
        <div class="shopcar-bottom">
        	<div class="wrapper rel">
            	<label class="fl ml10"><input type="checkbox" class="all-choose"/>全选</label>
                <a href="javascript:void(0);" class="fl ml30">删除选择的商品</a>
                <a href="javascript:void(0);" class="fl ml30">移动到我的收藏</a>
                <a href="#" class="fr settle-accounts">一键结算</a>
                <span class="fr mr30">总价（不含运费）：<span class="orange total-money">￥2000.00</span></span>
                <div class="fr mr20 dib" id="readyChoose">已选择<span class="red pl5 pr5" id="chooseNums">3</span>件商品
                	<img src="images/arrow.png"/>
                    <!--选中商品层-->
                    <div class="ready-choose hide">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--购物车列表 End-->
</div>

<script type="text/javascript" src="js/verifyForm.js"></script>
<script type="text/javascript">
window.onload = function(){
	var pruductInfo = document.getElementsByClassName("product-info");//单个商品
	var stroreInfo = document.getElementsByClassName("store-choose");//单个商店
	var allChoose = document.getElementsByClassName("all-choose");//选择全部商品
	for(var i = 0;i < pruductInfo.length;i++){
		//减少
		pruductInfo[i].querySelectorAll(".sl-subtract")[0].onclick = function(){
			var currVal = Number(this.nextElementSibling.value);
			if(currVal < 2){
				verifyForm.tips("不能再小啦~");
			}else if(currVal > 100){
				verifyForm.tips("不能再大啦~");
			}else{
				this.nextElementSibling.value = currVal-1;
				productPrice();
				totalMoney();
			}
		}
		//增加
		pruductInfo[i].querySelectorAll(".sl-addition")[0].onclick = function(){
			//判断是否是可以操作的数值
			var currVal = Number(this.previousElementSibling.value);
			if(currVal > 100){
				verifyForm.tips("不能再大啦~");
			}else{
				this.previousElementSibling.value = currVal+1;
				productPrice();
				totalMoney();
			}
		}
		//单个商品选择
		pruductInfo[i].querySelectorAll(".product-choose")[0].onchange = function(){
			/*
				判断是否店铺商品全部选择
				判断是否所有商品全部选择
			*/
			if(this.checked){//如果为true，我们就判断
				var isTrue = true;//有没有选择所有
				var isStore = true;//有没有选择店铺
				var currStore = this.parentElement.parentElement.parentElement;//获取整个店铺
				for(var m = 0;m < currStore.querySelectorAll(".product-info").length;m++){//遍历店铺里面所有商品
					//过滤失效
					if(!currStore.querySelectorAll(".product-info")[m].querySelectorAll(".product-choose")[0].checked){
						if(currStore.querySelectorAll(".product-info")[m].className.indexOf("pi-gray") >= 0){
							continue;
						}
						isStore = false;
						isTrue = false;
						break;
					}
				}
				currStore.querySelectorAll(".store-choose")[0].checked = isStore;
				if(isTrue){
					for(var j = 0;j < pruductInfo.length;j++){
						if(!pruductInfo[j].querySelectorAll(".product-choose")[0].checked){
							if(pruductInfo[j].className.indexOf("pi-gray") >= 0){
								continue;
							}
							isTrue = false;
							break;
						}
					}
				}
				document.getElementsByClassName("all-choose")[0].checked = isTrue;
				document.getElementsByClassName("all-choose")[1].checked = isTrue;
				
			}else{//店铺选择和选择所有按钮肯定都为false
				for(var v = 0;v < allChoose.length;v++){
					allChoose[v].checked = false;
				}	this.parentElement.parentElement.parentElement.querySelectorAll(".store-choose")[0].checked = false;
			}
			totalMoney();
		}
		
		
	
	}
	
	//单个店铺选择
	for(var i = 0;i < stroreInfo.length;i++){
		stroreInfo[i].onchange = function(){
			var currStoreObj = this.parentElement.parentElement.querySelectorAll(".product-info");
			if(this.checked){
				for(var l = 0;l < currStoreObj.length;l++){
					currStoreObj[l].querySelectorAll(".product-choose")[0].checked = true;
				}
				var isTrue = true;//有没有选择所有
				for(var m = 0;m < pruductInfo.length;m++){//遍历店铺里面所有商品
					//过滤失效
					if(!pruductInfo[m].querySelectorAll(".product-choose")[0].checked){
						if(pruductInfo[m].className.indexOf("pi-gray") >= 0){
							continue;
						}
						isTrue = false;
						break;
					}
				}
				document.getElementsByClassName("all-choose")[0].checked = isTrue;
				document.getElementsByClassName("all-choose")[1].checked = isTrue;
			}else{
				//取消选中
				for(var v = 0;v < allChoose.length;v++){
					allChoose[v].checked = false;
				}
				for(var l = 0;l < currStoreObj.length;l++){
					currStoreObj[l].querySelectorAll(".product-choose")[0].checked = false;
				}
			}
			
			
			
			totalMoney();
		}
	}
	for(var i = 0;i < allChoose.length;i++){
		allChoose[i].onchange = function(){
			var isCheck = false;
			if(this.checked){//true
				isCheck = true;
			}
			for(var m = 0;m < pruductInfo.length;m++){
				pruductInfo[m].querySelectorAll(".product-choose")[0].checked = isCheck;
			}
			for(var v = 0;v < stroreInfo.length;v++){
				stroreInfo[v].checked = isCheck;
			}
			for(var s = 0;s < allChoose.length;s++){
				allChoose[s].checked = isCheck;
			}
			totalMoney();
		}
	}


	//商品价格计算
	function productPrice(){
		for(var i = 0;i < pruductInfo.length;i++){
			pruductInfo[i].querySelectorAll(".sl-total-price")[0].textContent = Number(pruductInfo[i].querySelectorAll(".sl-price")[0].textContent.trim())*Number(pruductInfo[i].querySelectorAll(".sl-num")[0].value.trim());
		}
	}
	productPrice();
	//计算总价
	function totalMoney(){
		var money = 0;
		for(var i = 0;i < pruductInfo.length;i++){//pi-gray
			//判断当前的选中状态和商品是否失效
			if(pruductInfo[i].querySelectorAll(".product-choose")[0].checked && pruductInfo[i].className.indexOf("pi-gray") < 0){
				money += Number(pruductInfo[i].querySelectorAll(".sl-price")[0].textContent.trim())*Number(pruductInfo[i].querySelectorAll(".sl-num")[0].value.trim());
			}
		}
		document.getElementsByClassName("total-money")[0].textContent = "¥"+money;
		document.getElementsByClassName("total-money")[1].textContent = "¥"+money
		
	}
	totalMoney();
	
	
	
	var initX; //触摸位置
	var moveX; //滑动时的位置
	var X = 0; //移动距离
	var objX = 0; //目标对象位置
	var productInfo = document.getElementsByClassName("product-info");
	for(var i = 0;i < productInfo.length;i++){
		productInfo[i].addEventListener("touchstart",function(event){
			event.preventDefault();
			var obj = event.target.parentNode.parentNode;
			if(obj.className.indexOf("product-info") >= 0){
				initX = event.targetTouches[0].pageX;
				//debugger
				objX = (obj.style.WebkitTransform.replace(/translateX\(/g,"").replace(/px\)/g,""))*1;//.replace(/px\)/g,"");//获取当前对象的位置
			}
			if(objX == 0){
				this.addEventListener("touchmove",function(event){
					event.preventDefault();
					var obj = event.target.parentNode.parentNode;
					if(obj.className.indexOf("product-info") >= 0){
						moveX = event.targetTouches[0].pageX;
						x = moveX - initX;
						if(x >= 0){
							obj.style.WebkitTransform = "translateX("+0+"px)"
						}else if(x < 0){
							var l = Math.abs(x);//转绝对值
							obj.style.WebkitTransform = "translateX("+(-(l > 80?80:l))+"px)";//最大滑动距离为80
						}
					}
					
				});
			}else if(objX < 0){
				this.addEventListener("touchmove",function(event){
					event.preventDefault();
					var obj = event.target.parentNode.parentNode;
					if(obj.className.indexOf("product-info") >= 0){
						moveX = event.targetTouches[0].pageX;
						x = moveX - initX;
						if(x >= 0){
							var r = -80 + Math.abs(x);
							obj.style.WebkitTransform = "translateX("+r+"px)"
							if(r > 0){
								r = 0;
								obj.style.WebkitTransform = "translateX("+r+"px)";
							}
						}else if(x < 0){
							obj.style.WebkitTransform = "translateX("+(-80)+"px)";//最大滑动距离为80
						}
					}
					
				});
			}
		});
		
		productInfo[i].addEventListener("touchend",function(event){
			event.preventDefault();
			var obj = event.target.parentNode.parentNode;
			if(obj.className.indexOf("product-info") >= 0){
				objX = (obj.style.WebkitTransform.replace(/translateX\(/g,"").replace(/px\)/g,""))*1;
				if(objX > -40){
					obj.style.WebkitTransform = "translateX("+0+"px)";
					objX = 0;
				}else{
					obj.style.WebkitTransform = "translateX("+-80+"px)";
					objX = -80;
				}
			}
			
		});
	}
	
}



</script>



</body>
</html>
